<!DOCTYPE html>
<html>
<head>
	<title>Percolation</title>
</head>
<body>
<canvas id ="percolation">
	
</canvas>



<script>
function drawBlock(object,x,y,size,color){
	object.beginPath();
	object.rect(x, y, size, size);
	object.fillStyle = color;
	object.fill();
}

function drawBorder(object,x,y,width,height,color){
	object.beginPath();
	object.lineWidth="1";
	object.strokeStyle="#888";
	object.rect(x, y, width, height);
	object.stroke();
}

function initiate(object, width, height){
	object.setAttribute("width",width);
	object.setAttribute("height",height);
	drawBorder(object.getContext("2d"),0,0,width,height,"#333");
}

function QUUnion(parent,weight,i,j){	// default is let i's parent be j
	if(weight[i]>weight[j]){
		parent[j]=i;
		weight[i]+=weight[j];
	}
	else{
		parent[i]=j;
		weight[j]+=weight[i];
	}
}

function QUFind(parent,weight,i,j){
	var iOrigin = i;
	var jOrigin = j;
	while(iOrigin!=parent[iOrigin]){
		iOrigin=parent[iOrigin];
	}
	while(jOrigin!=parent[jOrigin]){
		jOrigin=parent[jOrigin];
	}
	if(iOrigin===jOrigin)return true;
	else return false;
}


function main(){
	var sizeUnit = 8;
	var borderWidth = 1;
	var sizeAll = 200;
	var nwidth = sizeAll / (sizeUnit+2*borderWidth);
	var n = Math.floor(nwidth * nwidth);
	//console.log(n);
	var c = document.getElementById("percolation");
	var ctx = c.getContext("2d");
	initiate(c,sizeAll,sizeAll);
	drawBlock(ctx, borderWidth, borderWidth, sizeAll-borderWidth*2, "#000");

	// contruct the weighted quick union
	var parent = [];
	var weight = [];
	var open = [];
	for(var i = 0; i<n+2; i++){	//n+2 elements, 0,and n+1 are the top and bottom
		parent[i]=i;  // 0 is blocked
		weight[i]=1;	//default weight is 1
		open[i]=false;  //false is closed
	}
	for(var i = 0; i < nwidth; i++){ //first row connect to 0
		QUUnion(parent,weight,i+1,0);
	}
	for(var i = 0; i < nwidth; i++){ //last row connect to n+1
		QUUnion(parent,weight,n-i,n+1);
	}

	//  randomly open some block
	var maxN = n;
	var connected = false;
	while(maxN-- && connected===false){
		var rand = Math.floor((Math.random() * n) + 1);
		open[rand] = true;
		console.log('rand = ' +rand);
		//if(open[rand-1]===true && rand-1>0)QUUnion(parent,weight,rand,rand-1);
		// if(open[rand+1]==true && rand+1<n+1)QUUnion(parent,weight,rand,rand+1);
		// if(open[rand-nwidth]==true && rand-nwidth>0)QUUnion(parent,weight,rand,rand-nwidth);
		// if(open[rand+nwidth]==true && rand+nwidth>0)QUUnion(parent,weight,rand,rand+nwidth);

		if(QUFind(parent,weight,0,rand)===true){
			drawBlock(ctx,Math.floor(rand/nwidth)*(borderWidth*2+sizeUnit)+borderWidth,rand%nwidth*(borderWidth*2+sizeUnit)+borderWidth,sizeUnit,"blue");}
		else{
			drawBlock(ctx,Math.floor(rand/nwidth)*(borderWidth*2+sizeUnit)+borderWidth,rand%nwidth*(borderWidth*2+sizeUnit)+borderWidth,sizeUnit,"#FFF");
		}
		if(QUFind(parent,weight,0,n+1)===true){connected = true;}
	}

}

main();

</script>

</body>
</html>